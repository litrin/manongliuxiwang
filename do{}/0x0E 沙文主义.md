##0x0E 沙文主义

不知道从什么时候起，作为传统的电子商务淡季的11月份，已经逐渐的变成了一年一度的冲销量季节。作为一个新兴的电子商务公司，十一的长假一过，整个公司上下都明显的忙碌起来。工作区里少了好多大声的聊天和各式各样的流言蜚语，多的是此起彼伏的电话铃声。作为一个支持部门，刘希望的IT部门自然不需要跟顾客直接打交道，但毕竟关系到整个公司的年终奖问题，IT已经悄悄的将部门的工作重心转移到了应对届时可能爆发的访问量上。

“根据我做的压力测试，现在公司的这套架构，最多能够保证150ms的响应时间。这个时间意味着在所谓’1秒黄金时间’上，我们可以做到理论7个用户的在线。按照公司运营部门给到我的数据是～”刘希望打开了自己的笔记本，里面的每一页上都被他用各种各样的笔横七竖八的划的乱七八糟，以至于他花了很长的时间才在某一页的角落里找到了一个数据。
“根据我手上的数据，目前我们的转化率不到0.7％。”刘希望环顾了一下在会议室的其它同事。这次的部门全体会议相比往常来说，多了好多的技术气息。而且这技术气息并非是来自于IT技术，更多的来自运营和商务部分。他相信，作为一个工程师为主力的团队，明确化的分工往往导致了大家对自己领域之外的话题莫不关系。这并非是一个好事，刘希望空出了足够多的时间给部门同事的目的就是想通过时间的停顿让大家可以及时的消化，或者随时的提出自己的疑问。
“转化率是什么意思？”小明总算忍不住要提问了。
“这个问题嘛～”刘希望将右手的五指并拢，指向了蓓蓓，说：“这个问题还是请蓓蓓来回答吧。”
与刘希望的慢条斯理不同的是，蓓蓓用很快的语速回答到：“转化率的意思就是用户访问网页的数量和进行下一步操作的比值。0.7%的概念意味着每1000次访问，就会有一个用户尝试着下单。对于2线3线的电子商务公司来说这个水平不能算很差，中等水平吧。”
刘希望点了点头表示同意。他接着说到：“我们假定在’双11’那天的转化率没有发生明显的变化，那这也就是意味着在高峰时间每1分钟两单的概念就意味着……”，刘希望在白板上写了一个巨大的“>5pv/s”，写完了这个巨大的阿拉伯数字之后，仿佛连自己都被吓到了似的，刘希望感觉到了自己后背上的寒毛都竖了起来。“理论上讲是没有问题的，没错吧？换成悲观值的话我们现在的状况根本是支撑不了的。”
“还有一点是带宽上的，我们平均下来一个页面大约在150～200K之间。换算下来，5个用户同时在线的话每秒传输1M数据，我们当前的10M是无法传输的。”
“为什么说10兆带宽无法支撑1M的传输量？”，这次是闫欢抛出了问题。
“OK，这个是一个习惯上的缩写导致的混乱。1M的文件事实上是1MByte，而10M带宽的单位是bit。发音很相似，但事实上是两个单位。1Byte等于8bit，那也就是说至少要保证8M的理论带宽没错吧？可事实上算上冗余数据和带宽损耗，1MByte每秒已经差不多是10M带宽的极限了！”
闫欢眼睛里的疑惑不见了，他似乎是懂了。
“好吧，说了这么多，为的是听听大家的意见，怎么样可以搞定这个数据？”其实刘希望自己这笔帐很早之前就已经计算过了，而且事实上他在运营部的会议上只承诺了5分钟4单的水平。但作为IT部门的内部会议，他故意将任务难度提升到了当前系统的极限。

出乎意料的是，这次是小庄打破了沉寂。“我前些天参加了一个活动，有个牛人用Python的一个叫zope的web框架，实现了PHP很难实现的大并发。而且开发非常简单，运维起来很轻松，是能够完全替代PHP的解决方案！”
其实对于刘希望来说，Python语言是他的第二语言，用起来也算是得心应手。虽说如此，但对于他来说，将一个对于整个团队来说都很陌生的语言运用到整个项目中是一个风险巨大的项目。但出于对小庄探索精神的尊重和鼓励，而且对于刘希望本人来，他也确实对这种新技术非常感兴趣。“那你能给我们解释解释它为什么这么牛吗？”
“其实具体的情况我也不是很清楚，总之就是它采用了一个新的线程模型，能够压榨出更多的系统资源。”
对于这种一知半解的解释，刘希望很是不满意，觉得这种“就是好来就是好”的解释真的不是一个工程师应该具有的态度。但他还是鼓励道：“好吧，我的建议是你可以先去研究研究，什么时候分享给大家。”
“我的建议是我们尽快的将公司的网站迁移到zope的架构上来，越快越好！如果现在就动身的话，3周以内应该可以将大部分的页面重构出来，还能赶上’双十一’活动。”
听到这里，刘希望清楚的明白，小庄是彻底的被zope给洗了脑。考虑到现实问题，他决定妥协一下。“好吧，不过考虑到现实的风险，我的建议是你可以在这几天的时间内从用户引导页开始重构。”
“什么风险！人家网站已经运行了好几年了，从来都不出问题。没什么风险的。”
“就这样，我决定了！”刘希望终于采用了专制的方式结束了这个不算愉快的技术讨论。

“那个……”小庄忽然间语气变了，在座的所有人都向他投出了奇怪的目光。小庄的语气忽然变了，明显的变的有些后劲不足。他弱弱的说：“其实，其实我还不会用Python，我只是写过几行python而已，现在也忘的差不多了。”
这个奇怪的回答非但没有让还沉浸在专制之中的刘希望生气，反而让他一下子笑岔了气。在被咳嗽声打断了许久之后，刘希望用一种半开玩笑的语气说到：“那你刚才不是属于纯粹瞎扯么？你自己都没有用过的东西，你自己都没踩过的坑就打算带着大家一起跳？这个呢就属于技术上的’沙文主义’，总是信奉某些搞不好还是特定场景下的优化数据。而彻彻底底的忘了到底什么是自己想要的。”
小庄的头深深的低下了，用很小的声音说到：“其实我是打算通过这次一并学习python和zope。”
这个时候小明也站出来打圆场，“小庄呢，也是好心，还不是为了让大家能够在最快速便捷的情况下解决并发的问题嘛。只是他呢，还缺乏这方面的经验而已。”
刘希望忽然意识到现在的状况成了自己当着一个部门的面批评小庄，这会严重的损伤小庄的积极性。他立即转换了一个语气，说到：“我觉得对于这件事，我花个几分钟，讲讲我自己的一个故事吧。”
众人的眼睛一下子亮了起来，纷纷正襟危坐起来。

刘希望用手推了一下眼镜，慢慢的说：
“原本我还在学校的时候，我曾经是FreeBSD论坛上的一个活跃分子，见人就向他们推荐FreeBSD。当时觉得这个操作系统简单干净，还有一个几乎包罗万象的port系统，不需要去网上找可以很容易的安装各种软件，而且它还是一个很严谨的Unix——这个呢本身是个人爱好，无可后非。可后来工作了以后没多久，我当时就参加了一个项目，也是一个php架构的项目。然后我呢就自说自话的给项目中的开发机装了FreeBSD。”
“这个没有什么问题啊？”
“对的！问题就出在后来。一开始在做界面的时候，没有人发现集成环境有什么特殊的，本来嘛，从web server的角度上来看，两个操作系统的差异早就被cover掉了。但好玩在用户后来修改了需求，数据库从原先的mysql替换成了Oracle。Oracle从来就不官方支持FreeBSD的操作系统。当初的我搜了一大堆的文章，最终做法呢就是通过FreeBSD的一个扩展，骗过了Oracle让它认为操作系统是一个Redhat Linux，硬生生的把Oracle给弄了起来。”
闫欢忍不住说到：“这不是皆大欢喜的结局吗？”
“问题才刚刚开始！这个方案——或者说这个方法，本质上说是将一个需要相当靠谱的数据库应用通过一个非常不靠谱的兼容层跑在一个小众操作系统平台之上。这个结果可想而之：只是跑起来而已，周期性的状况百出，各种操作均不能正常的进行下去。而且最要命的是找遍了Google也没有什么人解决过类似的问题。”
沉寂了一会儿，刘希望摘下了眼镜，用手指擦了擦眼镜片，又顺手戴了回去。“大家就没有人关心后续吗？”
“其实我已经猜到了，不知道对不对，愿闻其详！”小庄说到。
“没错，到头来就是只能推翻这个操作系统，回到了之前一直被我各种诅咒的Redhat。花了这么多的精力去做了一件其实一开始就是很多余的事情，只能说’reservered  by myself’。好吧，暂且不谈为这件事我多次被同事骂。
说了这么多，我只是想在这里重申一下：操作系统也好，语言也好，包括你使用的各种软件，归根结底呢，只是一个工具而已。你们的工作内容是通过对各种工具的使用，一方面满足用户提出的各种需求，另一方面是对你自己思路，自己idea的表达。而工具只有趁手不趁手，只有适合不适合这个项目，没有什么过多的好坏区别，更不要去上升到沙文主义的高度，撇开场景去信仰几个测试指标。没有几个人在意毕加索他画画用什么牌子的笔！”

刘希望停顿了很久，而且整个会议室似乎根本没有出现他所期望的大讨论。他似乎有些失落，用目光环视了整个会议室。
蓓蓓开口了，她说：“那后来你还在用FreeBSD吗？”
“说实话，那个时候我还是没有从沙文主义的圈子里绕出来。也是挺有意思的，这种思维模式的特点就是干什么事情都特别极端——要么就爱的要死，一旦恨就恨的要死——跟琼瑶剧的核心思想很像。”这个比喻引发了哄堂大笑，等笑声平静下来之后，刘希望接着说：“在差不多冷藏了它1年之后，有一天我忽然发现了FreeBSD用来做纯网络服务器还是很有优势的，于是逐渐摆脱了这个漩涡。不过，自从进了我们公司之后就不在用了，各位知道为什么吗？”
所有的人，除了刘希望自己都在摇头。
“那是因为，我们都在使用Linux！”，刘希望的手凭空的写下了一个“L”，“就好比是打仗的时候，为什么有’制式武器’这一说。每个人都用一样的枪，那军需官只要供应一种子弹就可以了，这将大大降低运维的成本。兴许对于某个人来说，他的效率开始会有所下降，但是作为一个完整的公司，这样一种相互妥协的前题下效率反而是最高的！我们现在团队里几乎都会点PHP，小明会点Java和.net，我和小庄写过Python，当然首选的是PHP，这个是由我们共同决定的开发语言。”
小明迫不及待的打断了刘希望的话题，他问到：“那就解释解释特种兵的武器为什么都是杂七杂八的吧。”这似乎是一个不大不小的反对意见。
“你说的没错！’特种作战’已经把原因涵盖了起来。相比普通作战讲究集团整体的作战效率，特种兵更加强调个人的作战能力。有些时候，我们确实需要些特定的case可以特事特办，一方面是为了在时间和效率上达到平衡，另一方面也是为之后的趋势找到一个方向。比如这一次，我觉得就是一个不错的机会，我们可以抽空看看zope，用户引导页相对来说受影响的范围不大，而且经我之前对zope的了解，它应该很适合这种短平快的页面开发。不要迷信那几个测试数据，看看它到底适合什么样的场景。开发成本、运维成本、易读性、可靠性、安全性等，这些数据绝对不是每家公司都愿意公开的数据，然而这些数据比那几个性能指标重要的多！”

会议室里像开了锅一样，刘希望总算成功的引发了大家的讨论。在这件事情上，只要有讨论，说明大家至少已经听懂了这个故事，明白了他对于这次启用新技术的看法。
“很抱歉，我班各位从每秒5次并发的研讨上跑题跑到了这里。看样子现在大家已经没有什么兴趣继续讨论应对双11的话题了。这样吧，大家有什么好的点子，尽管随时来找我，我这几天也不限于采用开会的方式来跟各位讨论这个话题。大家坐的这么近，都快背靠背了，有问题有想法随时吼出来就好了。这次呢，我和小庄两个人先研究研究zope。不管怎么样吧，等我们初步的把坑踩光，我就回直接分享给你们！”

时钟逐渐的走向了11:30的样子。
“那个什么，实在不好意思，这个会拖的时间太长了。我们一起去吃饭吧。没有了沙文主义，大家各自点各自的。”
